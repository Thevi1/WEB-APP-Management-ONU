{% extends 'layout.html' %}

    {% block content %}
    <!-- Main Content -->
    <main class="main-content" style="margin-top:80px;">
        <!-- Top Navigation (judul dan tombol) -->
        <div class="top-nav d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-0">Topology Management</h2>
                <!-- <p class="mb-0">Lorem ipsum dolor sit amet consectetur adipisicing elit.</p> -->
            </div>
            <div class="d-flex align-items-center">
                <button class="btn btn-outline-primary">
                    <i class="fas fa-map me-1"></i> Peta Terintegrasi
                </button>
            </div>
        </div>
        <!-- Statistics Cards -->
        <div class="row">
            <div class="col-md-3">
                <div class="stat-card olt glass-effect">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number">{{ total_olt }}</div>
                            <p class="stat-label">Total OLT</p>
                        </div>
                        <i class="fas fa-server icon-color-blue fa-2x"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card odc glass-effect">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number">{{ total_odc }}</div>
                            <p class="stat-label">Total ODC</p>
                        </div>
                        <i class="fas fa-box icon-color-green fa-2x"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card odp glass-effect">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number">{{ total_odp }}</div>
                            <p class="stat-label">Total ODP</p>
                        </div>
                        <i class="fas fa-wifi icon-color-orange fa-2x"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card onu glass-effect">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number">{{ total_onu }}</div>
                            <p class="stat-label">Total ONU</p>
                        </div>
                        <i class="fas fa-home icon-color-teal fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
        <!-- Tab Navigation -->
        <div class="tab-buttons">
            <button class="tab-btn">
                <i class="fas fa-server me-1"></i> OLT
            </button>
            <button class="tab-btn">
                <i class="fas fa-box me-1"></i> ODC
            </button>
            <button class="tab-btn">
                <i class="fas fa-wifi me-1"></i> ODP
            </button>
            <button class="tab-btn active">
                <i class="fas fa-home me-1"></i> ONU
            </button>
            <button class="tab-btn ms-auto">
                <i class="fas fa-search me-1"></i> Scan
            </button>
        </div>
        <!-- ONU Table -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h5 class="mb-0">
                    <i class="fas fa-cog me-2"></i>
                    Daftar ONU
                    <small class="text-muted">Optical Network Unit</small>
                </h5>
            </div>
            <div>
                <button class="btn btn-outline-secondary btn-sm me-2 btn-sync">
                    <i class="fas fa-sync me-1"></i> Sinkronisasi Status ONU
                </button>
                <button class="btn btn-primary btn-sm">
                    <i class="fas fa-plus me-1"></i> Tambah ONU
                </button>
            </div>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-2 mt-2">
            <div class="text-muted small">
                Menampilkan {{ start_index }}-{{ end_index }} dari {{ total_onu }} data
            </div>
            <form method="get" class="d-flex align-items-center">
                <label class="me-2 small">Baris per halaman</label>
                <select name="per_page" class="form-select form-select-sm me-2" style="width:auto" onchange="this.form.submit()">
                    {% for n in [10,20,50,100] %}
                    <option value="{{ n }}" {% if per_page == n %}selected{% endif %}>{{ n }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" name="page" value="{{ page }}"/>
            </form>
        </div>
        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-dark table-hover mb-0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Serial Number</th>
                            <th>MAC Address</th>
                            <th>Status</th>
                            <th>Distance</th>
                            <th>Temperature</th>
                            <th>RxPower</th>
                            <th>TxPower</th>
                            <th>RTT</th>
                            <th>Online Time</th>
                            <th>Offline Time</th>
                            <th>Alarms</th>
                            <th>Vendor/Model</th>
                            <th>PON/Port</th>
                            <th>IP Address</th>
                            <!-- <th>Deregister</th>
                            <th>Map</th> -->
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for onu in onus %}
                        <tr>
                            <td>{{ onu.id }}</td>
                            <td><code>{{ onu.serial_number }}</code></td>
                            <td><code>{{ onu.mac_address }}</code></td>
                            <td>
                                <span class="status-badge status-online">{{ onu.status }}</span>
                            </td>
                            <td>{{ onu.distance }}</td>
                            <td>
                                <span class="status-badge temperature-lainnya">{{ onu.temperature }}</span>
                            </td>
                            <td>
                                <span class="status-badge {% if onu.rx_power == 'Tinggi' %}power-tinggi{% else %}power-lainnya-tinggi{% endif %}">
                                    {{ onu.rx_power }}
                                </span>
                            </td>
                            <td>{{ onu.tx_power }}</td>
                            <td>{{ onu.rtt }}</td>
                            <td>{{ onu.online_time }}</td>
                            <td>{{ onu.offline_time }}</td>
                            <td>
                                <span class="status-badge status-online">{{ onu.alarms }}</span>
                            </td>
                            <td>{{ onu.vendor_model }}</td>
                            <td>{{ onu.pon_port }}</td>
                            <td>{{ onu.ip_address }}</td>
                            <!-- <td>{{ onu.deregister }}</td>
                            <td>{{ onu.map }}</td> -->
                            <td>
                                <button class="btn btn-outline-primary btn-custom">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-outline-danger btn-custom">
                                    <i class="fas fa-trash" style="padding: 0%;"></i> Hapus
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <nav aria-label="Pagination" class="mt-3">
            <ul class="pagination pagination-sm justify-content-end">
                <li class="page-item {% if not has_prev %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('dashboard', page=1, per_page=per_page) }}" tabindex="-1">First</a>
                </li>
                <li class="page-item {% if not has_prev %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('dashboard', page=prev_page or 1, per_page=per_page) }}" tabindex="-1">Previous</a>
                </li>

                {# Windowed page numbers #}
                {% set window = 2 %}
                {% set start_p = 1 if page - window < 1 else page - window %}
                {% set end_p = total_pages if page + window > total_pages else page + window %}
                {% for p in range(start_p, end_p + 1) %}
                <li class="page-item {% if p == page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('dashboard', page=p, per_page=per_page) }}">{{ p }}</a>
                </li>
                {% endfor %}

                <li class="page-item {% if not has_next %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('dashboard', page=next_page or total_pages, per_page=per_page) }}">Next</a>
                </li>
                <li class="page-item {% if not has_next %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('dashboard', page=total_pages, per_page=per_page) }}">Last</a>
                </li>
            </ul>
        </nav>
    </main>
    {% endblock %}

    {% block scripts %}
    <script>
        // Add some interactivity to the table
        document.querySelectorAll('tr').forEach(row => {
            row.addEventListener('click', function() {
                // Remove highlight from all rows
                document.querySelectorAll('tr').forEach(r => {
                    r.style.backgroundColor = '';
                });
                // Highlight clicked row
                this.style.backgroundColor = 'rgba(88, 166, 255, 0.1)';
            });
        });
        // Auto-refresh data every 30 seconds
        setInterval(() => {
            fetch('/api/onus')
                .then(response => response.json())
                .then(data => {
                    console.log('Data refreshed:', data);
                    // You can update the table here with new data
                })
                .catch(error => console.error('Error fetching data:', error));
        }, 30000);
    </script>
    {% endblock %}
